version: '2'
services:
  editor-app:
    extends:
      file: ../app.yml
      service: app
    volumes:
      # docker for Container from Ubuntu 14.04 host
      - /usr/bin/docker:/usr/bin/docker
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/lib/x86_64-linux-gnu/libapparmor.so.1:/usr/lib/x86_64-linux-gnu/libapparmor.so.1
      - /usr/lib/x86_64-linux-gnu/libltdl.so.7:/usr/lib/x86_64-linux-gnu/libltdl.so.7
      - /lib/x86_64-linux-gnu/libsystemd-journal.so.0:/lib/x86_64-linux-gnu/libsystemd-journal.so.0
      - /lib/x86_64-linux-gnu/libcgmanager.so.0:/lib/x86_64-linux-gnu/libcgmanager.so.0
      - /lib/x86_64-linux-gnu/libnih.so.1:/lib/x86_64-linux-gnu/libnih.so.1
      - /lib/x86_64-linux-gnu/libnih-dbus.so.1:/lib/x86_64-linux-gnu/libnih-dbus.so.1
      - /lib/x86_64-linux-gnu/libdbus-1.so.3:/lib/x86_64-linux-gnu/libdbus-1.so.3
      - /lib/x86_64-linux-gnu/libgcrypt.so.11:/lib/x86_64-linux-gnu/libgcrypt.so.11
    environment:
      ENV: local

  editor-log:
    extends:
      file: ../log.yml
      service: log
    volumes_from:
      - editor-app

  # editor-db:
  #   extends:
  #     file: ../db.yml
  #     service: db

  # editor-md:
  #   extends:
  #     file: ../md.yml
  #     service: md
  #   links:
  #     - editor-db

  nodered-app:
    extends:
      file: ../../conb/compose/app.yml
      service: app
    depends_on:
      - nodered-db
    links:
      - nodered-db:database

  nodered-db:
    extends:
      file: ../../conb/compose/db.yml
      service: db

  nodered-webpack:
    extends:
      file: ../../conb/compose/webpack.yml
      service: webpack
    # setting for AWS
    depends_on:
      - editor-log
    logging:
      driver: fluentd
      options:
        fluentd-address: localhost:24224
        tag: editor.webpack-log
